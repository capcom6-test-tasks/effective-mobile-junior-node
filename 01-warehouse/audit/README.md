# Сервис истории действий с товарами

Реализует запись истории операций с товарами.

## Настройки

Настройка осуществляется с помощью переменных окружения:

| Переменная     | Описание                                       | Значение по умолчанию                               |
| -------------- | ---------------------------------------------- | --------------------------------------------------- |
| `NODE_ENV`     | Окружение: `production` или `development`      | `development`                                       |
| `PORT`         | Порт веб-сервера                               | `3001`                                              |
| `DATABASE_URL` | Строка подключения к базе данных               | `postgresql://postgres:postgres@localhost/em-audit` |
| `BROKER_URL`   | Строка подключения к брокеру сообщений (Redis) | `redis://localhost:6379/0`                          |
| `QUEUE_NAME`   | Имя очереди                                    | `products:events`                                   |

## Запуск

Предварительная установка зависимостей: `npm install`.

Запуск в режиме разработки с автоматическим перезапуском:  `npm run dev`.

Запуск в рабочем режиме:  `npm run start`.

## API

Все запросы имеют общий префикс `/api/v1`.

| Метод         | Запрос                                                                                                                                                                                                                                                                   | Ответ                                                                                       | Описание                                                                                    |
| ------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------- |
| `GET /events` | Query-параметры: <br/> `plu` - отбор по PLU <br/> `shop_id` - отбор по ИД торговой точки <br/> `date_gte`/`date_lte` - отбор по периоду <br/> `action` - отбор по действию <br/> `page` - номер страницы <br/> `limit` - лимит строк в одной странице (по умолчанию 100) | `{ "events": [{date: Date, plu: number, action: string, shop_id?: number, details: any}] }` | `{ "events": [{date: Date, plu: number, action: string, shop_id?: number, details: any}] }` | Получение истории действий по фильтрам |

Примеры запросов: [requests.http](./requests.http).

## Особенности реализации

Поскольку задание описывает лишь высокоуровневые требования без уточнения многих моментов, то был принят ряд решений по моментам, не описанным в задании:

* инициализация БД выполняется самим сервисом при запуске;
* постраничная навигация реализована простейшим образом через номер страницы и лимит, хотя для данной задачи лучше бы подошла курсорная навигация.
